nh-lighting
===========
Server side swift for the hackspace automated lighting

macOS
=====
Code can be build with either the Xcode project or with `swift build`

Docker deployment
=================
Currently this is running on Queen

The PADockerfiles are generated by Perfect Assistant 3.0

Build the intermediary docker image with our dependencies, only needs doing if `PADockerfile_build` has changed 
```bash
sudo docker build -f PADockerfile_build -t perfectassistant/nh-lighting:latest
```

Use that image to compile 
```bash
sudo docker run \
    --volume=/home/dpslwk/github/instrumentation-lighting:/perfectbuild \
    --volume=/home/dpslwk/github/instrumentation-lighting/.packages_lin:/perfectbuild/Packages \
    --volume=/home/dpslwk/github/instrumentation-lighting/.build_lin:/perfectbuild/.build \
    --volume=/home/dpslwk/github/instrumentation-lighting/.package_lin.pins:/perfectbuild/Package.pins \
    --volume=/home/dpslwk/github/instrumentation-lighting/.package_lin.resolved:/perfectbuild/Package.resolved \
    --workdir=/perfectbuild --rm -t -p 8080:8080 perfectassistant/nh-lighting swift build -v
```

Start a new container running
```bash
sudo docker run \
--volume=/home/dpslwk/github/instrumentation-lighting:/perfectbuild \
--volume=/home/dpslwk/github/instrumentation-lighting/.packages_lin:/perfectbuild/Packages \
--volume=/home/dpslwk/github/instrumentation-lighting/.build_lin:/perfectbuild/.build \
--volume=/home/dpslwk/github/instrumentation-lighting/.package_lin.pins:/perfectbuild/Package.pins \
--volume=/home/dpslwk/github/instrumentation-lighting/.package_lin.resolved:/perfectbuild/Package.resolved \
--workdir=/perfectbuild --rm -t -p 8181:8181 -name nh-lighting perfectassistant/nh-lighting .build_lin/debug/nh-lighting .build_lin/debug/nh-lighting
```

Adding the instrumentation network to docker (only needs to be done once)
```bash
sudo docker network create -d macvlan  \
    --subnet=192.168.0.0/24  \
    --ip-range=192.168.0.128/25 \
    --gateway=192.168.0.1  \
    -o parent=eth0.3 instrumentation
```

Connect our container to the instrumentation network and restart the container
```bash
sudo docker network connect instrumentation nh-lighting
sudo docker restart nh-lightning
```
